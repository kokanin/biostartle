use IO::Socket::INET;
use Time::HiRes qw(usleep);
use warnings;
use strict;
use Socket qw(IPPROTO_TCP);
use String::HexConvert ':all';
#doesn't really seem to autoflush ?

$|=1;
my $sock;
my $bla;


# this script adds my right middle finger as user 3

$sock = new IO::Socket::INET( PeerHost => "10.10.10.2",PeerPort => "1471",Proto => "tcp") or die "error connecting: $!\n";
binmode($sock); setsockopt($sock,IPPROTO_TCP,Socket::TCP_NODELAY(),1) || die "fuck me sideways: $!";

sub send{ my $data = $_[0]; print $sock hex_to_ascii($data); usleep(250000); }
sub getshort{ print "reading short response\n";$sock->recv($bla,40);usleep(250000);print "response: $bla\n";}
sub getvaried{ print "reading varied response\n";$sock->recv($bla,int($_[0]));print "response: $bla\n"; }

print "sending 1\n";
&send("7B7B3C3CD1B900000100000000000100DA753DA96656A2024D29EB006A9CBC123C0300003E3E7D7D");
getshort();


print "sending 3\n";
&send("7B7B3C3CD1B9000001000000000001004AD0256479E52C9267A26FEC198C8DD31D0300003E3E7D7D");
getshort();

print "sending 5\n";
&send("7B7B3C3CD1B9000001000000000001003DE2AECA2592F3DF1BA6DE73D137FF8A250300003E3E7D7D");
getshort();

getvaried(32);
getvaried(264);

print "sending 9\n";
&send("7B7B3C3CD1B900000100000000000100A6A82C2359AF5C1D99BFEF0323C92961010300003E3E7D7D");
getshort();

print "sending 11\n";
&send("7B7B3C3CD1B900000100000000000100DA753DA96656A2024D29EB006A9CBC123C0300003E3E7D7D");
getshort();

print "sending 13\n";
&send("7B7B3C3CD1B9000001000000000001007950980DDF947E68739CD0875C43D9E1A70300003E3E7D7D");
getshort();

print "sending 15\n";
&send("7B7B3C3CD1B900000100000000000100455C1746D97AEFF7A6841ABA2E9875E1");

print "sending fingerprint\n";
&send("2A45C384E3B10E145C8CFDA8295226A7AB7729B47819014ABEAF419B0279D8576A62D15EB3340CFF485A846291932B17F7BBCBE899120A2530BE0B5F06C01889538AA33D3F0D550931B8EEAB5D30933554B216E8B0B9A590D0ECFCFC635E38CF881B3BAAA507F841D07C6B1F2E233FA1CF07AB062919F17A4EDC67918D42B593EA0177CD9975043FE76AA1417BDB685680CC11A6E5D368D890EADF9532981149AAE38F9D0D5D2583555615F4DB5F25CC88453B9B65C7F307939CEA223F809F6775663BE57AAD355DCFAFD76830072307CFB3D4AF198392E4A365FD874E4D20C44C9D8AE52A376ECCF1592C235AEDA67D9D45565D94435342A68A85BB401C94AC76040682E5C4B2CA73932D3ADA689702B813229A45452D4FCB48BA942329A033C603115F21D34DC32765D9B0171BEE2A86A80877B6AC787DD041BC4BF932B99AC917A15AD6427B13DE0695D3251558528548D812D77E95B64214B425756F54D3522DED49212F6A4D2E4AD58112A0273BE0AC133AF0C4FCAF0EF56F4937C71F8677943A90C9F67D9CAE974FB5146DA8B2BAB105C87BED3EB7BD28E79915A1F3C4D2EE34C03725D04982B6C20DE504365233BDBAE7D166912D32F70387D7E9259C782A501838689F27DBCC3B6B08CBA7835ED4BA61FE3DCE8733643B1055B4BA1F2BF41716C87A3284C7DA8061BF2B60E434D96CFA845D306F46735D27D3FAC7E65AA0B859AF33713FF9A6016406A446909372752C64E610CBD9E0FF29911D303760A9E206019A31CAE59F4783A6526DECA9FE1D335923FAEF10DB0709F7AFA9E461531B4FA7CFBF62B36B77D366E37A5E52E3FB2639A4D28346C1C70A997895581E75DE1CB3C10BD62A492B849C11F3B365433E5AB975B0BB4280491CAEE9D779E52553CC5023213B49849A1E73CB31A4E0A5DB26CC4CB5D9EFE4E9316B7C9CCCA66DA8AD4BAA5192E3C8D3F29057B1406355366C3F203F5F8503371BB36A6D1A4120783E35664C5B752A68CB71DB53176D8262D91F8BE0ACC4E1BD39E284F0EBFB1B5BFE4688CECB2E07008D68447DA48A2CFD549397BDD2236291E9F9E5C41971F2F6627ABF6358CDF30433A9046DE21D8652BF498E26B336293DDB8C67D8273C083BADBBFD04BF09B4B432C6A80274E323E759040C930BD7E4AC8C839370F639254FD0AC3B573EAA58996BA26C4C39C90B09EAF454A7AD7323DF24110BB7C9377326E6756A16753445DB6D00FFD425C48835D366CDE713D92DD6D60750B9E2B7F800003E3E7D7D");
getshort();


print "sending 18\n";
&send("7B7B3C3CD1B900000100000000000100A6A82C2359AF5C1D99BFEF0323C92961010300003E3E7D7D");
getshort();

#getvaried(32);
#getvaried(24);
#getvaried(32);
#getshort();

$sock->close;
print "Socket closed\n";
